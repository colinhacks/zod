# Zod 4

## Ecosystem

- Zod 4 Certified 🎗️

libraries:

- zod-to-json-schema
- zod-to-open-api
- json-schema-to-zod
- zod-openapi
- OpenAI
- zod-utilz?
-

* check all ecosystem libraries by star count

## New features

- Adds top-level functions for string formats
  - Simpler syntax, more treeshakable
  - `z.email()`, `z.uuidv4()`, etc
- Adds new string formats
  - `z.e164`
  - `z.base64`
  - `z.jwt`
  - `z.ascii`
  - `z.utf8`
  - `z.lowercase`
  - `z.iso.date`
  - `z.iso.datetime`
  - `z.iso.duration`
  - `z.iso.time`
- `z.file()`
  - `.min()`
  - `.max()`
  - `.type()`
- Add new number formats
  - `z.int()`
  - `z.float32()`
  - `z.float64()`
  - `z.int32()`
  - `z.uint32()`
- Add new bigint formats
  - `z.int64`
  - `z.uint64`

- Simplifies error customization
  - Unifies `message` and `errorMap` into `error`
  - Access `issue.input` directly
- Adds `z.looseObject` and `z.strictObject`
- Supports multiple values in `z.literal()`
- Adds `z.success()`
- Adds `z.stringbool()`
- Add `z.overwrite()`
- Add `z.transform()`
- Optionals in ZodTuple
- Registries and metadata
  - `.meta()` and `GlobalMeta`
  - `z.globalRegistry`
  - `z.registry()`
  - `z.jsonSchemaRegistry()`
- `z.templateLiteral()`
- `reportInput`

## Breaking changes

- New issue formats
- New generics
- Drop static `.create()` methods
- Drops `z.promise()`
  - This was always useless
- No default exports
  - `import z from "zod"` -> `import * as z from "zod"`
- Drop `z.string().ip()`
  - separates `.ipv4()` and `.ipv6()`
- `ZodFunction`
  - no longer a schema, it's a standalone utility
  - new API: `z.function({input, output})`
  - separate `.implement()` and `.implementAsync()`
- Drop convenience methods `z.ostring()`, `z.onumber()`, etc
- Drop support for symbols in `z.literal()`
  - These technically aren't literals and can't be compared with `===` anyway
- Drops `ZodEffects`
- Refinements are now stored inside schemas
  - `.refine()` and `.superRefine()` to longer perform type narrowing
  - Calls like `.min(5)` now "stack" on each other instead of overwriting
- Transform and preprocess are now `ZodTransform`
  - Transforms work in conjunction with `z.pipe()`
- Deprecates `z.nativeEnum`, just use `z.enum`

- ZodObject
  - Deprecate `.strict()` — use top-level `z.strictObject()`
  - Deprecate `.nonstrict()` — use top-level `z.looseObject()`
  - Drop `.deepPartial()`
- Drops `required_error` and `invalid_type_error`
  - Unified `error` field
- `ZodError`
  - No longer extends `Error`
  - Dropping `.formErrors` — use `.format()` instead
  - Dropping `.addIssue()`/`.addIssues()` (push directly to `err.issues`)
- Drops `ZodObject` `.nonstrict()`
- Dropping support for ES5
  - Zod relies on `Set` internally
- ZodNumber
  - `POSITIVE_INFINITY` and `NEGATIVE_INFINITY` are no longer valid values for `z.number()`
- `z.number().int()` no longer accepts unsafe integers
- ZodDate
  - `Invalid Date` is no longer a valid `Date`
- Refinements are internal
- ZodObject `.keyof()` now returns `ZodLiteral` not `ZodEnum`
- No need to specify discriminator in `z.discriminatedUnion`
- No more (val: Output)=>string as second argument to `.refine()`. Use error map.
- "Hard-coded" error map now takes precedence over contextual error map
- No question mark for `unknown`/`any` schemas
- No support for `null` or `undefined` in `z.literal`
  - `z.literal(null)`
  - `z.literal(undefined)`
  - this was never documented
- `ZodArray.nonempty()` does not change inferred type
- Array min/max/length checks now run after parsing. This means they won't run if the parse has already aborted.
- Defs have been re-designed
  - Renamed `typeName` -> `type`
- Drops single-argument `z.record()`
- Intersection merge errors are now thrown as Error not ZodError
  - These usually do not reflect a parse error but a structural problem with the schema
- Consolidates `unknownKeys` and `catchall` in ZodObject
- Dropping
  - `ZodBranded`: purely a static-domain annotation
  - `ZodFunction`
- The `description` is now stored in `z.defaultRegistry`, not the def
  - No support for `description` in factory params
  - Descriptions do not cascade in `.optional()`, etc
- Enums:
  - ZodEnum and ZodNativeEnum are merged
  - `.Values` and `.Enum` are removed. Use `.enum` instead.
  - `.options` is removed
